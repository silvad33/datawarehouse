CREATE VIEW vAD_FixedAssetDepreciation
AS
SELECT [Level]
	, [Accounts - CapEx]
	, [Description]
	, '' AS [Enter monthly amounts -->]
	, ISNULL([01/2020],0) AS [01/2020]
	, ISNULL([02/2020],0) AS [02/2020]
	, ISNULL([03/2020],0) AS [03/2020]
	, ISNULL([04/2020],0) AS [04/2020]
	, ISNULL([05/2020],0) AS [05/2020]
	, ISNULL([06/2020],0) AS [06/2020]
	, ISNULL([07/2020],0) AS [07/2020]
	, ISNULL([08/2020],0) AS [08/2020]
	, ISNULL([09/2020],0) AS [09/2020]
	, ISNULL([10/2020],0) AS [10/2020]
	, ISNULL([11/2020],0) AS [11/2020]
	, ISNULL([12/2020],0) AS [12/2020]
FROM (
	SELECT CONCAT(LEFT(CONCAT('000',dbo.IONIS_FIELD(FAJ.OFFSETACCOUNTDISPLAYVALUE,'-',2)),3),' - ',FAJ.DATAAREAID) AS [Level]
		, CONCAT(A.MainAccountNumber,' - ',A.MainAccountDescription) AS [Accounts - CapEx]
		, CONCAT(FA.FIXEDASSETNUMBER,'-',FA.[NAME]) AS [Description]
		, CONCAT(LEFT(CONCAT('0',DATEPART(MONTH,FAJ.TRANSDATE)),2),'/',DATEPART(YEAR,FAJ.TRANSDATE)) AS TranDate
		, FAJ.CREDITAMOUNT AS TranAmount
	FROM AssetJournalEntityStaging AS FAJ
		INNER JOIN DimAccount AS A ON dbo.IONIS_FIELD(OFFSETACCOUNTDISPLAYVALUE,'-',1) = A.MainAccountNumber
		INNER JOIN AssetFixedAssetStaging AS FA ON REPLACE(FAJ.ACCOUNTDISPLAYVALUE,'\','') = FA.FIXEDASSETNUMBER AND FAJ.DATAAREAID = FA.DATAAREAID
	WHERE TRANSDATE >= '1/1/2020'
) AS qrySource
PIVOT
(
	SUM(TranAmount)
	FOR TranDate IN ([01/2020],[02/2020],[03/2020],[04/2020],[05/2020],[06/2020],[07/2020],[08/2020],[09/2020],[10/2020],[11/2020],[12/2020])
) AS qryPivot
